<!doctype html>
<html>
<head>
<meta charset='UTF-8'><meta name='viewport' content='width=device-width initial-scale=1'>
<link rel='stylesheet' href='../../../plugins/googleapis/fonts.css'>
<link rel="stylesheet" href="../../../dist/css/markdown.css">
</head>
<body class='typora-export os-windows'><div class='typora-export-content'>
<div id='write'  class=''><ul><li><p><strong><span>URL重定向漏洞</span></strong></p><p><span>URL跳转漏洞，也叫开放重定向漏洞。URL 跳转漏洞是指后台服务器在告知浏览器跳转时，未对客户端传入的重定向地址进行合法性校验，通过修改恶意站点的 URL 值，攻击者可能成功发起网络钓鱼诈骗并窃取用户凭据。</span></p></li></ul><p></br></p><ul><li><p><strong><span>进行URL跳转的常见方式</span></strong></p><p><span>a 标签跳转、meta 标签内跳转、JavaScript 跳转、header 头跳转</span></p></li></ul><p></br></p><ul><li><p><strong><span>URL重定向漏洞成因</span></strong></p><ol start='' ><li><p><span>代码层忽视 URL 跳转漏洞，或不知道/不认为这是个漏洞。</span></p></li><li><p><span>代码层过滤不严，用去取子串、取后缀等方法简单判断，代码逻辑可以被绕过。</span></p></li><li><p><span>对传入参数操作（域名剪切/拼接/重组）和判断不当，导致绕过</span></p></li><li><p><span>原始语言自带的解析 URL，判断域名的函数库出现逻辑漏洞或者意外特性</span></p></li><li><p><span>服务器/容器特性、浏览器登对标准 URL 协议解析处理等差异性导致被绕过</span></p></li></ol></li></ul><p></br></p><ul><li><p><strong><span>URL重定向漏洞测试示例</span></strong></p><ol start='' ><li><p><span>在测试页面发现可能存在URL重定向漏洞的链接：</span><code>http://www.aaa.com/bbb?url=http://ccc.com</code></p></li><li><p><span>修改参数</span><code>url</code><span>进行测试，看是否产生跳转：</span><code>http://www.aaa.com/bbb?url=http://www.qq.com</code></p></li><li><p><span>若成功跳转到QQ（或其他测试网站），且能成功访问页面，则判断存在URL重定向漏洞。</span></p></li></ol></li></ul><p></br></p><ul><li><p><strong><span>URL重定向常见攻击点（测试点）</span></strong></p><ol start='' ><li><p><span>用户登录、统一身份认证、认证完进行跳转。</span></p></li><li><p><span>用户分享、收藏内容跳转。</span></p></li><li><p><span>跨站点认证、授权后。</span></p></li><li><p><span>站内其它链接跳转。</span></p></li><li><p><span>注册、注销、修改密码等。</span></p></li><li><p><span>账户切换、保存设置。</span></p></li></ol></li></ul><p></br></p><ul><li><p><strong><span>URL重定向漏洞危害</span></strong></p><ol start='' ><li><p><span>钓鱼攻击：攻击者可以利用URL重定向漏洞，在看似官方的网站上诱导用户访问涉黄涉赌非法网站、下载恶意软件或执行其他恶意操作等。</span></p></li><li><p><span>窃取用户信息：攻击者可以伪造一个看起来和原网站相似的假冒网站，诱使用户输入敏感信息，如用户名、密码、银行账户等，从而窃取用户的信息。</span></p></li><li><p><span>XSS漏洞： 通过 </span><code>javascript:alert(0)</code><span> 或 CRLF；</span></p></li><li><p><span>获取用户权限：伪造钓鱼网站、窃取登录凭证 token;</span></p></li><li><p><span>绕过检测：窃取 CSRF token, 绕过 SSRF， RCE 和名单</span></p></li><li><p><span>高级利用方法：配合其他功能 / 漏洞</span></p></li></ol></li></ul><p></br></p><ul><li><p><strong><span>URL重定向测试常用Payload</span></strong></p><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang="http" style="break-inside: unset;"><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang="http"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 9.51562px; left: 8px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation" style=""><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-error">https://pilot-fanqie.com</span></span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-atom">http:</span><span class="cm-string">//pilot-fanqie.com</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-atom">http:</span><span class="cm-string">//www.example.com.pilot-fanqie.com</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-atom">https:</span><span class="cm-string">//www.example.com.pilot-fanqie.com</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-atom">http:</span><span class="cm-string">//pilot-fanqie.com/www.example.com</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-atom">https:</span><span class="cm-string">//pilot-fanqie.com/www.example.com</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-atom">http:</span><span class="cm-string">//www.example.com?url=http://pilot-fanqie.com</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-atom">https:</span><span class="cm-string">//www.example.com?url=https://pilot-fanqie.com</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-error">/pilot-fanqie.com</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-error">//pilot-fanqie.com</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-error">///pilot-fanqie.com</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-error">////pilot-fanqie.com</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-error">///pilot-fanqie.com//..</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-error">////pilot-fanqie.com//..</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-atom">http:</span><span class="cm-string">//www.example.com@www.pilot-fanqie.com</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-atom">https:</span><span class="cm-string">//www.example.com@www.pilot-fanqie.com</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-atom">http:</span><span class="cm-string">//www.pilot-fanqie.com\www.example.com</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-atom">https:</span><span class="cm-string">//www.pilot-fanqie.com\www.example.com</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-atom">http:</span><span class="cm-string">//www.pilot-fanqie.com#www.example.com</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-atom">https:</span><span class="cm-string">//www.pilot-fanqie.com#www.example.com</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-atom">http:</span><span class="cm-string">//www.pilot-fanqie.com?www.example.com</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-atom">https:</span><span class="cm-string">//www.pilot-fanqie.com?www.example.com</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-atom">http:</span><span class="cm-string">//www.pilot-fanqie.com\\www.example.com</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-atom">https:</span><span class="cm-string">//www.pilot-fanqie.com\\www.example.com</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-error">.pilot-fanqie.com</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-error">.baidu</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-error">127.0.0.1</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-atom">127.0.0.1:</span><span class="cm-string">80</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-atom">http:</span><span class="cm-string">//localhost</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-atom">https:</span><span class="cm-string">//localhost</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-error">0x7f.0.0.1</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-error">0</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-error">0.0.0.0</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-atom">dict:</span><span class="cm-string">//127.0.0.1:80</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-atom">file:</span><span class="cm-string">//etc/passwd</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-error">//example.com@google.com/%2f..</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-error">///google.com/%2f..</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-error">///example.com@google.com/%2f..</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-error">////google.com/%2f..</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-atom">https:</span><span class="cm-string">//google.com/%2f..</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-atom">https:</span><span class="cm-string">//example.com@google.com/%2f..</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-atom">/https:</span><span class="cm-string">//google.com/%2f..</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-atom">/https:</span><span class="cm-string">//example.com@google.com/%2f..</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-error">//google.com/%2f%2e%2e</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-error">//example.com@google.com/%2f%2e%2e</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-error">///google.com/%2f%2e%2e</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-error">///example.com@google.com/%2f%2e%2e</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-error">////google.com/%2f%2e%2e</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-atom">/http:</span><span class="cm-string">//example.com</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-atom">/http:</span><span class="cm-string">/example.com</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-atom">/https:</span><span class="cm-string">/%5cexample.com/</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-atom">/https:</span><span class="cm-string">//%09/example.com</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-atom">/https:</span><span class="cm-string">//%5cexample.com</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-atom">/https:</span><span class="cm-string">///example.com/%2e%2e</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-atom">/https:</span><span class="cm-string">///example.com/%2f%2e%2e</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-atom">/https:</span><span class="cm-string">//example.com</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-atom">/https:</span><span class="cm-string">//example.com/</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-atom">/https:</span><span class="cm-string">//example.com/%2e%2e</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-atom">/https:</span><span class="cm-string">//example.com/%2e%2e%2f</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-atom">/https:</span><span class="cm-string">//example.com/%2f%2e%2e</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-atom">/https:</span><span class="cm-string">//example.com/%2f..</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-atom">/https:</span><span class="cm-string">//example.com//</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-atom">/https:</span><span class="cm-string">example.com</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-error">/%09/example.com</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-error">/%2f%2fexample.com</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-error">/%2f%5c%2f%67%6f%6f%67%6c%65%2e%63%6f%6d/</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-error">/%5cexample.com</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-error">/%68%74%74%70%3a%2f%2f%67%6f%6f%67%6c%65%2e%63%6f%6d</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-error">/.example.com</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-error">//%09/example.com</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-error">//%5cexample.com</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-error">///%09/example.com</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-error">///%5cexample.com</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-error">////%09/example.com</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-error">////%5cexample.com</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-error">/////example.com</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-error">/////example.com/</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-error">////\;@example.com</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-error">////example.com/</span></span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom: 0px solid transparent; top: 1819px;"></div><div class="CodeMirror-gutters" style="display: none; height: 1819px;"></div></div></div></pre></li></ul><blockquote><p><span>注：使用时将example替换为原地址，作者自用的Payload字典包含了FUZZ测试，使用者需要自行判断。</span></p></blockquote><p></br></p><ul><li><p><strong><span>URL重定向漏洞预防</span></strong></p><ol start='' ><li><p><span>使用黑、白名单进行过滤。</span></p></li><li><p><span>在可能的情况下，让用户提供在服务器端映射到完整目标 URL 的短名称、ID 或令牌。</span></p></li><li><p><span>不允许将 URL 作为目标的用户输入。</span></p></li><li><p><span>如果无法避免用户输入，请确保提供的值有效、适用于应用程序，并且已为用户授权。</span></p></li><li><p><span>从应用程序中删除重定向功能，并将指向它的链接替换为指向相关目标 URL 的直接链接。</span></p></li></ol></li></ul><p></br></p><ul><li><p><strong><span>推荐学习文章</span></strong></p><ol><li><p><a href='https://zhuanlan.zhihu.com/p/682187427' target="_blank"><span>知乎-URL 重定向漏洞</span></a></p></li><li><p><a href='https://blog.csdn.net/weixin_44268918/article/details/132580301' target="_blank"><span>CSDN-URL重定向漏洞</span></a></p></li><li><p><a href='https://blog.csdn.net/weixin_46700042/article/details/108990392' target="_blank"><span>CSDN-URL重定向漏洞(中风险)</span></a></p></li><li><p><a href='https://blog.csdn.net/qq_33942040/article/details/109478181' target="_blank"><span>CSDN-URL重定向攻击</span></a></p></li><li><p><a href='https://community.sslcode.com.cn/643f555a986c660f3cf941f5.html' target="_blank"><span>URL跳转漏洞bypass小结</span></a></p></li></ol></li></ul></div></div>
</body>
</html>